#compdef my-unicorn

# my-unicorn zsh completion script
# Add this to your zsh completions directory or source it in your .zshrc

_my_unicorn() {
    local -a commands
    local state line
    
    # Define available commands
    commands=(
        'install:Install AppImages from catalog or URLs'
        'update:Update installed AppImages'
        'upgrade:Upgrade my-unicorn itself'
        'catalog:Browse AppImage catalog'
        'migrate:Migrate configuration to latest version'
        'remove:Remove installed AppImages'
        'backup:Manage AppImage backups and restore'
        'token:Manage GitHub authentication token'
        'auth:Manage GitHub authentication'
        'config:Manage configuration'
        'cache:Manage release data cache for better performance'
    )

    _arguments -C \
        '1: :->command' \
        '*: :->args' \
        && return 0

    case $state in
        command)
            _describe 'my-unicorn commands' commands
            _values 'global options' \
                '--help[Show help information]' \
                '--version[Show version information]'
            ;;
        args)
            case ${line[1]} in
                install)
                    _arguments \
                        '(--concurrency --no-icon --no-verify --no-desktop --verbose)--concurrency[Maximum number of parallel installs]:number:' \
                        '(--concurrency --no-icon --no-verify --no-desktop --verbose)--no-icon[Skip downloading application icons]' \
                        '(--concurrency --no-icon --no-verify --no-desktop --verbose)--no-verify[Skip AppImage verification]' \
                        '(--concurrency --no-icon --no-verify --no-desktop --verbose)--no-desktop[Skip desktop entry creation]' \
                        '(--concurrency --no-icon --no-verify --no-desktop --verbose)--verbose[Show detailed logging during installation]' \
                        '--help[Show help information]' \
                        '1:app app:_files'
                    ;;
                update)
                    _arguments \
                        '(--check-only --refresh-cache --verbose)--check-only[Only check for updates without installing]' \
                        '(--check-only --refresh-cache --verbose)--refresh-cache[Bypass cache and fetch fresh data from GitHub API]' \
                        '(--check-only --refresh-cache --verbose)--verbose[Show detailed logging during update]' \
                        '--help[Show help information]' \
                        '1:app app:_files'
                    ;;
                upgrade)
                    _arguments \
                        '(--check)--check[Only check for upgrades without installing]' \
                        '--help[Show help information]' \
                        '1:app app:_files'
                    ;;
                catalog)
                    _arguments \
                        '(--installed --available --info)--installed[Show installed AppImages (default)]' \
                        '(--installed --available --info)--available[Show available applications from catalog with descriptions]' \
                        '(--installed --available --info)--info[Show detailed information about a specific app]:app name:' \
                        '--help[Show help information]' \
                        '1:app app:_files'
                    ;;
                migrate)
                    _arguments \
                        '(--force)--force[Force migration even if already up-to-date]' \
                        '--help[Show help information]'
                    ;;
                remove)
                    _arguments \
                        '(--keep-config)--keep-config[Keep configuration files]' \
                        '--help[Show help information]' \
                        "1:app app:_files"
                    ;;
                backup)
                    _arguments \
                        '(--restore-last --restore-version --list-backups --cleanup --info)--restore-last[Restore the latest backup version]' \
                        '(--restore-last --restore-version --list-backups --cleanup --info)--restore-version[Restore a specific version]:version:' \
                        '(--restore-last --restore-version --list-backups --cleanup --info)--list-backups[List available backups for the specified app]' \
                        '(--restore-last --restore-version --list-backups --cleanup --info)--cleanup[Clean up old backups according to max_backup setting]' \
                        '(--restore-last --restore-version --list-backups --cleanup --info)--info[Show detailed backup information]' \
                        '--help[Show help information]' \
                        '1:app app:_files'
                    ;;
                cache)
                    local -a cache_commands
                    cache_commands=(
                        'clear:Clear cache entries'
                        'stats:Show cache statistics and storage info'
                    )
                    
                    if [[ ${#line} -eq 2 ]]; then
                        _describe 'cache commands' cache_commands
                        _values 'cache options' '--help[Show help information]'
                    elif [[ ${line[2]} == "clear" ]]; then
                        _arguments \
                            '--all[Clear all cache entries]' \
                            '--help[Show help information]' \
                            '1:app app:_files'
                    elif [[ ${line[2]} == "stats" ]]; then
                        _arguments '--help[Show help information]'
                    fi
                    ;;
                auth)
                    _arguments \
                        '(--status)--status[Show authentication status]' \
                        '--help[Show help information]' \
                        '1:app app:_files'
                    ;;
                config)
                    _arguments \
                        '(--show --reset)--show[Show current configuration]' \
                        '(--show --reset)--reset[Reset configuration to defaults]' \
                        '--help[Show help information]' \
                        '1:app app:_files'
                    ;;
                token)
                    _arguments \
                        '(--save --remove)--save[Save GitHub authentication token]' \
                        '(--save --remove)--remove[Remove GitHub authentication token]' \
                        '--help[Show help information]' \
                        '1:app app:_files'
                    ;;
            esac
            ;;
    esac

    return 0
}